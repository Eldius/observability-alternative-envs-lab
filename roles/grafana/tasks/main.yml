---
# tasks file for grafana
- name: Debug architecture
  debug:
    msg: "{{ ansible_architecture }}"
  notify:
    - Restart Grafana

- name: Install Grafana package
  ansible.builtin.apt:
    deb: "{{ package_url }}"
  become: true
  notify:
    - Restart Grafana

- name: Configure Loki datasource
  ansible.builtin.copy:
    src: ../files/datasources/loki.yaml
    dest: /usr/share/grafana/conf/provisioning/datasources/loki.yaml
  become: true
  notify:
    - Restart Grafana

- name: Configure Loki dashboard
  ansible.builtin.copy:
    src: ../files/dashboards/loki.json
    dest: /usr/share/grafana/conf/provisioning/dashboards/loki.json
  become: true
  notify:
    - Restart Grafana

- name: Generate custom.ini file
  ansible.builtin.copy:
    src: ../files/conf/custom.ini
    dest: /etc/grafana/grafana.ini
  become: true
  notify:
    - Restart Grafana
